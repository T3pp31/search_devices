# Search Devices – 機能追加案

本ドキュメントは、現在の実装（CIDR/IPリストのPingスキャン＋逆引き表示）を踏まえ、ネットワーク関連のGUIツールとして有用性と操作性を高めるための提案をまとめたものです。

## 現状
- 機能: CIDRスキャン／IPリストスキャン、ICMP生存判定、逆引きDNS、停止・クリア、結果表示。
- 実装: OSの`ping`をサブプロセス実行（Windows/Linuxで引数切替）、UI更新は`app::channel`経由、表示は`TextDisplay`（整形テキスト）。
- 課題: 並列なしで時間がかかる、表示の操作性（ソート/検索/エクスポート）が限定的、DNSで遅延する場合がある。

## 優先度高の追加機能
- 並列スキャン: 同時実行数を設定可能にし、大規模CIDRの所要時間を短縮。
- 進捗/統計: 進捗バー、残り件数、成功/失敗カウント、経過時間を表示。
- Ping設定の可変化: タイムアウト、回数、インターバル、最大同時数をUIから調整。
- 逆引きDNS ON/OFF: チェックボックスで切替（無効時は高速化）。DNSタイムアウトの短縮も考慮。
- エラーメッセージの明確化: 無効なCIDR/権限不足/`ping`未検出などをUIに明示。
- 結果エクスポート: CSV/JSON保存とクリップボードコピー。

## ネットワーク拡張
- 簡易ポートチェック: 代表ポート（例: 22/80/443等）の疎通で用途の当たりを付ける。
- ARP/MAC/OUI: 同一L2内でARPによりホスト検出し、ベンダ名を表示。
- IPv6対応: CIDR/リスト両タブでIPv6スキャン（`ping -6`等）。
- NIC自動検出: ローカルIFとサブネット候補を一覧し、ワンクリックでCIDR入力。
- 継続監視/差分: N秒ごと再スキャンし、新規出現/消失をハイライト通知。

## 運用・UX
- テーブル化と操作性: `TextDisplay`から`Table`へ移行し、ソート/フィルタ/検索を提供。
- 停止の即時性: 実行中Pingの中断（`spawn`+`kill`、またはICMPライブラリでキャンセル）。
- レート制限: PPSや同時数の上限でネットワーク負荷を抑制。
- 右クリック/ショートカット: IPコピー、ブラウザ/SSH起動、行のクイック操作。
- 設定保存: タイムアウト・並列数・表示設定を永続化。ダークモード対応。

## 実装メモ
- 並列化: `std::thread`＋セマフォ/ワーカー、あるいは`rayon`。UI更新は既存どおり`app::channel`でメインスレッドへ集約。
- 高速/中断可能Ping: `surge-ping`等のICMPクレート検討（権限要件注意）。代替は`Command::spawn`でプロセスを握り`Child::kill`。
- テーブルUI: `fltk::table::Table`/`TableRow`に移行し、モデル（Vec）を保持して再描画でソート/フィルタ実装。
- エクスポート/ダイアログ: `fltk::dialog::FileDialog`で保存先選択、CSVは内部モデルから整形。
- ポート/ARP: `TcpStream::connect_timeout`で簡易ポートチェック、ARPは`arp -a`/`ip neigh`のパースか`pnet`で実装。

## 初手ロードマップ（提案）
1. 並列スキャンの導入（最大同時数を設定可能）
2. 進捗バーと統計の表示（成功/失敗/残り/経過時間）
3. CSVエクスポート機能（結果テーブルを保存）
4. 逆引きDNSのON/OFF切替とDNSタイムアウト調整

### 受け入れ基準（例）
- /24ネットワークのスキャン時間がシリアル実行比で短縮される（同時数=32で目安50–80%短縮）。
- 進捗バーがリアルタイムに更新され、停止操作で即座に停止する。
- 保存したCSVがExcel等で開け、列が崩れない。
- DNSをOFFにすると表示が速くなる（体感できるレベル）。

